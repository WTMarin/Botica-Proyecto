{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block page_heading %}Panel de Control Principal{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">Bienvenido, {{ current_user.username }}</h2>
        
        {% if current_user.role == 'Admin' %}
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary mb-3 shadow-sm">
                    <div class="card-header">Ventas Hoy <i class="bi bi-bar-chart-line-fill"></i></div>
                    <div class="card-body">
                        <h4 class="card-title">{{ total_sales_today }}</h4>
                        <p class="card-text">Total consolidado entre todas las sucursales.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-secondary mb-3 shadow-sm">
                    <div class="card-header">Ventas Ayer <i class="bi bi-bar-chart-line"></i></div>
                    <div class="card-body">
                        <h4 class="card-title">{{ total_sales_yesterday }}</h4>
                        <p class="card-text">Referencia inmediata de rendimiento.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-info mb-3 shadow-sm">
                    <div class="card-header">Sucursales Activas <i class="bi bi-shop-window"></i></div>
                    <div class="card-body">
                        <h4 class="card-title">{{ total_farmacias }}</h4>
                        <p class="card-text">Total de farmacias registradas en el sistema.</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="card shadow p-4">
            <h5>Opciones Rápidas (Rol: {{ current_user.role }})</h5>
            <ul class="list-group list-group-flush mt-3">
                
                {# TAREAS DE VENDEDOR / OPERACIONES #}
                <li class="list-group-item list-group-item-warning font-weight-bold">
                    <i class="bi bi-person-fill"></i> Tareas de Vendedor
                </li>

                {% if current_user.role == 'Admin' %}
                <li class="list-group-item">
                    <a href="{{ url_for('seleccionar_farmacia_ventas') }}"><i class="bi bi-shop me-2"></i> Iniciar Ventas (Seleccionar Sucursal)</a>
                </li>
                {% else %}
                <li class="list-group-item">
                    <a href="{{ url_for('pantalla_ventas') }}"><i class="bi bi-cart-fill me-2"></i> Ir a Pantalla de Ventas</a>
                </li>
                {% endif %}
                
                <li class="list-group-item">
                    <a href="{{ url_for('mis_ventas') }}"><i class="bi bi-journal-text me-2"></i> Reporte de Mis Ventas del Día</a>
                </li>

                {# GESTIÓN Y ADMINISTRACIÓN (Solo Admin) #}
                {% if current_user.role == 'Admin' %}
                <li class="list-group-item list-group-item-success font-weight-bold mt-3">
                    <i class="bi bi-gear-fill"></i> Gestión y Administración
                </li>

                <li class="list-group-item">
                    <a href="{{ url_for('gestion_stock') }}"><i class="bi bi-box me-2"></i> Gestión de Stock (Inventario por Sucursal)</a>
                </li>

                <li class="list-group-item">
                    <a href="{{ url_for('registro_compra') }}"><i class="bi bi-truck me-2"></i> Registrar Compras (Proveedor y Costos)</a>
                </li>

                <li class="list-group-item">
                    <a href="{{ url_for('gestion_usuarios') }}"><i class="bi bi-people-fill me-2"></i> Gestión de Usuarios</a>
                </li>
                
                <li class="list-group-item">
                    <a href="{{ url_for('agregar_farmacia') }}"><i class="bi bi-shop me-2"></i> Crear Nueva Sucursal</a>
                </li>
                
                {# REPORTES FINANCIEROS (Solo Admin) #}
                <li class="list-group-item list-group-item-info font-weight-bold mt-3">
                    <i class="bi bi-bar-chart-fill"></i> Reportes Financieros
                </li>
                <li class="list-group-item">
                    <a href="{{ url_for('reporte_global') }}"><i class="bi bi-graph-up me-2"></i> Reporte de Utilidad Global (Ventas, Costos y PMP)</a>
                </li>
                
                {% endif %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}